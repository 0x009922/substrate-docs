---
title: Generating On-chain Randomness
slug: /how-to-guides/v3/pallet-design/randomness
keywords: pallet design, intermediate, runtime, randomness
version: 3.0 
section: how to guides
category: pallet design
difficulty: 2
---

[Randomness](/v3/runtime/randomness)is used in computer programs for many applications. For example, gaming applications, NFT creation, and selecting block authors all require a degree of randomness.

True randomness is hard to come by in deterministic computers. This is particularly true in the context of a blockchain, when all the nodes in the network must agree on the state of the chain. FRAME provides runtime engineers with a source of randomness, using the [Randomness trait](/rustdocs/latest/frame_support/traits/trait.Randomness.html).
        
This guide will show you how to make use of FRAME's Randomness trait by using the `random` method and a nonce as a subject. For additional entropy to the randomness value, the last step shows how to assign the `RandomCollectiveFlip` pallet to the configuration trait of a pallet exposing some "random" type.


## Implement a randomness function inside a pallet

1. Import `Randomness`

  In the pallet you want to use, import the `Randomness` trait from `frame_support`:

  ```rust
  use frame_support::traits::Randomness;
  ```

  Include it in your pallet's configuration trait:

  ```rust
  #[pallet::config]
  pub trait frame_system::Config {
      type MyRandomness: Randomness<H256>;
  }
  ```

  Note that the `Randomness` trait specifies a generic return of type `Output`. Use [`sp_core::H256`][h256-rustdocs] in your pallet to satisfy that trait requirement.

  <Message
    type={`red`}
    title={`A warning on using this trait`}
    text=
      "As stated in
      [this trait's documentation](/rustdocs/latest/frame_support/traits/trait.Randomness.html),
      at best, this trait can give you randomness which was hard to predict a long time ago 
      but that has become easy to predict recently. 
      Keep this in mind when you evaluate your use of it.
      "
  />

1. Create a nonce.

  Use a nonce to serve as a subject for the `frame_support::traits::Randomness::random(subject: &[u8])` method.

  There are two steps to including a nonce in your pallet:

  * **Create a `Nonce` storage item.** This can be of type `u32` or `u64`. It does not need to be larger.

  * **Create a private nonce function.** This will be used to increment the nonce each time it's used.

  The `increment_nonce()` private function can be implemented in such a way that it both returns and updates the nonce. For example:

  ```rust
      fn get_and_increment_nonce() -> Vec<u8> {
          let nonce = Nonce::get();
          Nonce::put(nonce.wrapping_add(1));
          nonce.encode()
      }
  ```
  <br />
  <Message type='yellow' title='Note' text={`
  To learn more about [\`wrapping_add\`](/rustdocs/latest/funty/trait.IsInteger.html#tymethod.wrapping_add) and [\`encode()\`](/rustdocs/latest/frame_support/dispatch/trait.Encode.html#method.encode) in the Rust documentation.
  `}/>

1. Use Randomness in a dispatchable.

  Using the nonce, you can call the `random()` method that `Randomness` exposes. The code snippet below is a mock example that assumes relevant events and storage items have been implemented:

  ```rust
          #[pallet::weight(100)]
          pub fn create_unique(
        origin: OriginFor<T>)
        -> DispatchResultWithPostInfo {

                  // Account calling this dispatchable.
                  let sender = ensure_signed(origin)?;

                  // Random value.
          let nonce = Self::get_and_increment_nonce();
                  let randomValue = T::MyRandomness::random(&nonce);

                  // Write the random value to storage.
                  <MyStorageItem<T>>::put(randomValue);

                  Self::deposit_event(Event::UniqueCreated(randomValue));
              }
  ```

1. Update your pallet's runtime implementation

  Because you have added a type to your pallet's configuration trait, `Config` opens up the opportunity to further enhance the randomness derived by the `Randomness` trait. This is accomplished by using the [Randomness Collective Flip pallet][rcf-pallet-rustdocs].

  Using this pallet alongside the `Randomness` trait will significantly improve the entropy being processed by `random()`.

  In `runtime/src/lib.rs`, assuming `pallet_random_collective_flip` is instantiated in `construct_runtime` as `RandomCollectiveFlip`, specify your exposed
  type in the following way:

  ```rust
  impl my_pallet::Config for Runtime{
      type Event;
      type MyRandomness = RandomCollectiveFlip;
  }
  ```

## Examples

- [Randomness used in BABE](https://github.com/paritytech/substrate/blob/master/frame/babe/src/randomness.rs)
- [FRAME's Lottery pallet](https://github.com/paritytech/substrate/blob/master/frame/lottery/src/lib.rs#L471)

## Related material

[Verifiable Random Functions](https://en.wikipedia.org/wiki/Verifiable_random_function)

[h256-rustdocs]: /rustdocs/latest/sp_core/struct.H256.html
[rcf-pallet-rustdocs]: /rustdocs/latest/pallet_randomness_collective_flip/index.html
